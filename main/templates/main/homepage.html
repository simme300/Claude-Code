{% extends 'base.html' %}

{% block title %}Homepage - Claude Code{% endblock %}

{% block content %}
<div class="container">
    <div class="homepage-header">
        <h1>Welcome back, {{ user.username }}!</h1>
        <p class="subtitle">Track your fitness journey</p>
    </div>
    
    {% if profile_incomplete %}
    <div class="alert alert-info">
        <strong>Complete your profile!</strong> 
        <a href="{% url 'main:edit_profile' %}">Add your age and weight</a> to get personalized insights.
    </div>
    {% elif bmr_incomplete %}
    <div class="alert alert-info">
        <strong>Add your gender!</strong> 
        <a href="{% url 'main:edit_profile' %}">Complete your profile</a> to calculate your Basal Metabolic Rate (BMR).
    </div>
    {% endif %}
    
    <div class="stats-overview">
        <h2>Your Stats</h2>
        <div class="stats-cards">
            <div class="stat-card">
                <h3>{{ total_workouts }}</h3>
                <p>Total Workouts</p>
            </div>
            
            {% if user_profile.age %}
            <div class="stat-card">
                <h3>{{ user_profile.age }}</h3>
                <p>Age</p>
            </div>
            {% endif %}
            
            {% if user_profile.current_weight %}
            <div class="stat-card">
                <h3>{{ user_profile.current_weight }} {{ user_profile.weight_unit }}</h3>
                <p>Current Weight</p>
            </div>
            {% endif %}
            
            {% if user_profile.body_fat_percentage %}
            <div class="stat-card">
                <h3>{{ user_profile.body_fat_percentage }}%</h3>
                <p>Body Fat</p>
            </div>
            {% endif %}
            
            {% if user_profile.calculate_bmr %}
            <div class="stat-card bmr-card">
                <h3>{{ user_profile.calculate_bmr|floatformat:0 }}</h3>
                <p>BMR (cal/day)</p>
                <small>Estimate only</small>
            </div>
            {% endif %}
            
            {% if calorie_summary.tdee %}
            <div class="stat-card">
                <h3>{{ calorie_summary.tdee|floatformat:0 }}</h3>
                <p>TDEE (cal/day)</p>
                <small>Total Daily Energy</small>
            </div>
            {% endif %}
            
            <div class="stat-card">
                <a href="{% url 'main:edit_profile' %}" class="btn btn-sm btn-outline">Edit Profile</a>
            </div>
        </div>
    </div>
    
    {% if calorie_summary.daily_target %}
    <div class="calorie-targets-section">
        <h2>Your Calorie Targets</h2>
        <div class="calorie-cards">
            <div class="calorie-card daily">
                <h3>{{ calorie_summary.daily_target|floatformat:0 }}</h3>
                <p>Daily Target</p>
                <small>calories per day</small>
            </div>
            
            {% if calorie_summary.adjusted_daily and calorie_summary.adjusted_daily != calorie_summary.daily_target %}
            <div class="calorie-card adjusted">
                <h3>{{ calorie_summary.adjusted_daily|floatformat:0 }}</h3>
                <p>Adjusted Daily</p>
                <small>based on recent eating</small>
            </div>
            {% endif %}
            
            {% if calorie_summary.weekly_target %}
            <div class="calorie-card weekly">
                <h3>{{ calorie_summary.weekly_target|floatformat:0 }}</h3>
                <p>Weekly Target</p>
                <small>calories per week</small>
            </div>
            {% endif %}
            
            {% if calorie_summary.monthly_target %}
            <div class="calorie-card monthly">
                <h3>{{ calorie_summary.monthly_target|floatformat:0 }}</h3>
                <p>Monthly Target</p>
                <small>calories per month</small>
            </div>
            {% endif %}
        </div>
        
        <div class="calorie-info">
            <p><strong>ðŸ’¡ How it works:</strong> Your daily calorie target is calculated based on your BMR, activity level, and weight goals. The adjusted daily target adapts based on your recent eating patterns to keep you on track with your weekly goals.</p>
        </div>
    </div>
    {% elif user_profile.target_weight %}
    <div class="calorie-incomplete">
        <h2>Calorie Targets</h2>
        <div class="alert alert-info">
            <strong>Almost ready!</strong> 
            <a href="{% url 'main:edit_profile' %}">Complete your profile</a> to see personalized calorie targets.
        </div>
    </div>
    {% endif %}
    
    {% if active_goals %}
    <div class="goals-section">
        <h2>Your Active Goals</h2>
        <div class="goals-list">
            {% for goal in active_goals %}
            <div class="goal-card">
                <div class="goal-header">
                    <h3>{{ goal.title }}</h3>
                    <span class="goal-type">{{ goal.get_goal_type_display }}</span>
                </div>
                {% if goal.description %}
                <p class="goal-description">{{ goal.description }}</p>
                {% endif %}
                {% if goal.target_value and goal.unit %}
                <div class="goal-target">
                    <strong>Target:</strong> {{ goal.target_value }} {{ goal.get_unit_display }}
                </div>
                {% endif %}
                {% if goal.target_date %}
                <div class="goal-date">
                    <strong>Target Date:</strong> {{ goal.target_date|date:"M d, Y" }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        <div class="goals-actions">
            <a href="{% url 'main:add_goal' %}" class="btn btn-primary">Add New Goal</a>
            <a href="{% url 'main:manage_goals' %}" class="btn btn-outline">Manage Goals</a>
        </div>
    </div>
    {% else %}
    <div class="goals-section">
        <h2>Your Goals</h2>
        <div class="empty-goals">
            <p>You haven't set any goals yet. Start by adding your first fitness goal!</p>
            <a href="{% url 'main:add_goal' %}" class="btn btn-primary">Add Your First Goal</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}